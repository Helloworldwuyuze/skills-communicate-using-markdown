# 3.5 DP 小节

## 背包

### 01背包

给定 $N$ 个物品，每个物品有一个质量 $w_i$ 和价值 $v_i$，求在质量和不超过 $W$ 的情况下的最大 $v_i$ 和。每个物品只能取一次。

---

设 $dp_{i,j}$ 表示选到 $i$ 个物品，背包容量是 $j$ 时的最大价值。显然，在 $j\le a_i$ 时，无法选择物品 $i$，于是 $dp_{i,j}=dp_{i-1,j}$。在能够选择的时候，选和不选需要取最大值，即 $dp_{i,j}=\max\{dp_{i-1,j},dp_{i-1,j-w_i}+v_i\}$。

另外，因为第 $i$ 层只与 $i-1$ 层有关，就可以把第一维压掉。注意滚动的背包需要从后到前，因为后面的状态会用到前面的状态。

此时的时间复杂度 $O(nW)$，在 $w_i$ 的范围远远小于 $v_i$ 时可以，但是如果反过来 $v_i$ 远小于 $w_i$，就需要把状态与记录的值调换。

设 $dp_{i,j}$ 表示第 $i$ 个物品，价值为 $j$ 时的最小重量，那么容易写出 $f_{i,j}=\min\{dp_{i-1,j},dp_{i-1,j-v_i}+w_i\}$。

相同地，这个式子也可以把第一维压掉。

## LCS

朴素的 LCS 就是判断 $i,j$ 时 $c1_i$ 是否与 $c2_j$ 相等，相等就令 $f_{i,j}=f_{i-1,j-1}+1$，否则就取 $\max\{f_{i-1,j},f_{i,j-1}\}$ 。

记录路径的时候，只需要在转移的时候记录时由哪个状态转移过来的。

## 拓扑 DP

在拓扑到 $u$ 的时候，对于 $\forall v\in son_u$，都进行填表更新。如果 $in_v=0$，那么将 $v$ 扔进队列中。

## 期望/概率 DP

概率 DP 的时候，我们大部分都正推，用 $f_i$ 去更新 $f_{i+x}(x>0)$，而在 期望DP 的时候，我们大部分去倒推，用最终状态推初始状态。

### AT_dp_I Coins

#### 题意描述

$N$ 个硬币，每个硬币朝上的概率是 $p_i$，求 $N$ 个硬币都抛完后，正面朝上的硬币的数量比朝下的多的概率。$(N\le 3\times 10^3)$

#### Solution

显然设 $dp_{i,j}$ 表示前 $i$ 个硬币有 $j$ 个朝上的概率。那么 $dp_{i,j}=dp_{i-1,j-1}\times p_i+dp_{i-1,j}\times (1-p_i)$。

### AT_dp_J Sushi

#### 题意描述

有 $N$ 个盘子，每个盘子里有 $a_i$ 个寿司。每次选择一个盘子 $i$，如果该盘子上还有寿司就吃掉一个，否则啥也不干，问最终吃完所有寿司的期望步骤是多少。其中 $1\le a_i\le 3$，$N\le 3 \times 10^3$。

#### Solution

一种朴素的想法是设 $f_{a_1,a_2,\dots,a_n}$ 表示每个盘子还剩下多少个寿司。那么 $f_{a_1,a_2,\dots,a_n}=1+\frac{1}{n}\sum\limits_{i=1}^nf_{a_1,a_2,\dots,\max\{a_i-1,0\},\dots,a_n}$。但是显然空间复杂度到达 $O(3^{300})$，稳稳地爆掉。
